;==============================================================================
; bat_expand
;
;==============================================================================
function bat_expand, filespecs, keys, val_ps, input_files

 n = n_elements(input_files)

 if(keyword_set(keys)) then $
  begin
   w = where(strlowcase(keys) EQ 'file_sample')
   if(w[0] NE -1) then $
    begin
     file_sample = (*val_ps[w[0]])[0]
     keys[w] = ''
    end

   w = where(strlowcase(keys) EQ 'file_select')
   if(w[0] NE -1) then $
    begin
     file_select = *val_ps[w[0]]
     keys[w] = ''
    end

   w = where(keys EQ '')
   if(w[0] NE -1) then $
    begin
     keys = rm_list_item(keys, w, only='')
     val_ps = rm_list_item(val_ps, w)
     if(NOT keyword_set(keys[0])) then $
      begin
       keys = ''
       val_ps = ptr_new()
      end
    end
  end

 for i=0, n-1 do $
       filespecs = append_array(filespecs, $
            read_txt_file(input_files[i], sample=file_sample, select=file_select))

 if(NOT keyword_set(filespecs)) then return, ''
 return, filespecs
end
;==============================================================================
