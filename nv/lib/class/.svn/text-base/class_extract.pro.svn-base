;===========================================================================
; class_extract
;
;  odp may be inhomogeneous, so we have to loop, using nv_dereference
;  one-by-one.
;
;
;===========================================================================
function class_extract, odp, class
 nv_notify, odp, type = 1

 if(NOT keyword_set(odp)) then return, 0

 n = n_elements(odp)
 for i=0, n-1 do $
  begin
   od = nv_dereference(odp[i])

   case class_search(od, class) of $
	0 : xxdp = odp[i]
	1 : xxdp = od.(0)
	2 : xxdp = (nv_dereference(od.(0))).(0)
	3 : xxdp = (nv_dereference( $
		    (nv_dereference(od.(0))).(0))).(0)
	4 : xxdp = (nv_dereference( $
		    (nv_dereference( $
		    (nv_dereference(od.(0))).(0))).(0))).(0)
	5 : xxdp = (nv_dereference( $
		    (nv_dereference( $
		    (nv_dereference( $
		    (nv_dereference(od.(0))).(0))).(0))).(0))).(0)
	6 : xxdp = (nv_dereference( $
		    (nv_dereference( $
		    (nv_dereference( $
		    (nv_dereference( $
		    (nv_dereference(od.(0))).(0))).(0))).(0))).(0))).(0)
	7 : xxdp = (nv_dereference( $
		    (nv_dereference( $
		    (nv_dereference( $
		    (nv_dereference( $
		    (nv_dereference( $
		    (nv_dereference(od.(0))).(0))).(0))).(0))).(0))).(0))).(0)
	else : xxdp = ptr_new()
   endcase

   xdp = append_array(xdp, xxdp)   
  end

 return, xdp
end
;===========================================================================



;===========================================================================
; class_extract
;
;
;===========================================================================
function _class_extract, odp, class
 nv_notify, odp, type = 1
 od = nv_dereference(odp)

 case class_search(od, class) of $
	0 : return, odp
	1 : return, od.(0)
	2 : return, (nv_dereference(od.(0))).(0)
	3 : return, (nv_dereference( $
		    (nv_dereference(od.(0))).(0))).(0)
	4 : return, (nv_dereference( $
		    (nv_dereference( $
		    (nv_dereference(od.(0))).(0))).(0))).(0)
	5 : return, (nv_dereference( $
		    (nv_dereference( $
		    (nv_dereference( $
		    (nv_dereference(od.(0))).(0))).(0))).(0))).(0)
	6 : return, (nv_dereference( $
		    (nv_dereference( $
		    (nv_dereference( $
		    (nv_dereference( $
		    (nv_dereference(od.(0))).(0))).(0))).(0))).(0))).(0)
	7 : return, (nv_dereference( $
		    (nv_dereference( $
		    (nv_dereference( $
		    (nv_dereference( $
		    (nv_dereference( $
		    (nv_dereference(od.(0))).(0))).(0))).(0))).(0))).(0))).(0)
	else : return, 0
 endcase

end
;===========================================================================



