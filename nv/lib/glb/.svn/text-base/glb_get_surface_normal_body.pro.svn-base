;===========================================================================
; glb_get_surface_normal_body.pro
;
; Inputs and outputs are in body coordinates.
; Note that the output vectors are NOT normalized.
;
;===========================================================================
function glb_get_surface_normal_body, gbxp, v
@nv_lib.include
 gbdp = class_extract(gbxp, 'GLOBE')
 nv_notify, gbdp, type = 1
 gbd = nv_dereference(gbdp)

 nt = n_elements(gbd)
 np = (size(v))[1]

 M = make_array(np,val=1)

 zz = [0,0,1d]##M
 vv = v_rotate(v, zz, [sin(gbd.lora)], [cos(gbd.lora)])

 rr = transpose(reform(gbd.radii[linegen3z(3,nt,np)], 3,nt,np,/over), [2,0,1])

 return, vv/rr^2
end
;===========================================================================
