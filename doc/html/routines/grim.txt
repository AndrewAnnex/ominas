GRIM


 PURPOSE:
	Graphical interface for oMINAS. 


 CATEGORY:
	NV/GR


 CALLING SEQUENCE:
	
	grim, arg


 ARGUMENTS:
  INPUT:
	arg:	The argument, if present, can be either a data descriptor or 
		a grim image number.  If a data descriptor, then a new grim
		instance will be created using that data descriptor and all
		keyword arguments apply to the new instance.  If a grim image
		number, then all keyword arguments apply to the grim instance
		identified by that number.  If the argument is not present, 
		then all keyword arguments apply to the most recently accessed
		grim instance; a new grim instance is created if none exist.

  OUTPUT: NONE


 KEYWORDS:
  INPUT:
	cd:	Replaces grim's current camera descriptor.  This may also be 
		a map descriptor, in which case, certain of grim's functions 
		will not be available.  When using a map descriptor instead 
		of a camera descriptor, you can specify a camera descriptor 
		as the observer descriptor (see the 'od' keyword below) and 
		some additional geometry functions will be available.

	od:	Replaces grim's current observer descriptor.  The observer
		descriptor is used to allow some geometry objects (limb,
		terminator) to be computed when usign a map descriptor instead
		of a camera descriptor.

	pd:	Adds a new planet descriptor.

	rd:	Adds a new ring descriptor.

	sd:	Adds a new star descriptor.

	sund:	Replaces grim's current sun descriptor.

	gd:	Generic descriptor giving some or all of the above descriptors.

     *	new:	If set, a new grim instance is created and all keywords apply
		to that instance.

     *	silent:	If set, many message are suppressed.

     *	xsize:	Size of the graphics window in the x direction.  Defaults to
		400 pixels.

     *	ysize:	Size of the graphics window in the y direction.  Defaults to
		400 pixels.

     *	zoom:	Initial zoom to be applied to the image.  If not given, grim
		computes an initial zoom such that the entire image fits on the
		screen.

     *	rotate:	Initial rotate value to be applied to the image (as in the IDL
		ROTATE routine).  If not given, 0 is assumed.

     *	order:	Initial display order to be applied to the image.

     *	offset:	Initial offset (dx,dy) to be applied to the image.

	erase:	If set, erase the current image before doing anything else.

     *	filter:	Initial filter to use when loading or browsing files.

     *	mode:	Initial cursor mode.  Choices are 'zoom', 'pan', 'tiepoint',
		'activate', and 'readout'.  Defaults to 'activate'.

     *	retain:	Retain settings for backing store (see "backing store" in 
		the IDL reference guide).  Defaults to 2.

     * menu_fname:	Name of a file containing additional menus to add to
			the grim widget.  The syntax follows that for cw_pdmenu.

     * fov:	Controls the number of camera fields of view to crop when
		the 'FOV' overlay settings is on.  If set, the FOV overlay
		settings is turned on.

     * hide:	If set, overlays are hidden w.r.t shadoes and obstructions.
 		Default is on. 

     * overlays: List of overlays to compute on startup.  Each element
                 is of the form:

                          type[:name1,name2,...]

                 where 'type' is one of {limbs, terminators, planet_centers, 
                 stars, rings, planet_grids} and the names identify the
                 name of the desired object.  Note that grim will load 
                 more objects than named if required by another startup 
                 startup overlay.  For example:

                         overlays='rings:a_ring'

                 will cause only one ring descriptor to load, whereas

                         overlays=['limbs:saturn', 'rings:a_ring']

                 will cause all of Saturn's rings to load because they are
                 required in computing the limb points (for hiding).

  OUTPUT: NONE


 RESOURCE FILE:
	The keywords marked above with an asterisk may be overridden using 
	the file $HOME/.grimrc.  Keyword=value pairs may be entered, one per
	line, using the same syntax as if the keyword were entered on the IDL 
	command line to invoke grim.  Lines beginning with '#' are ignored.
	Keywords entered in the resource file override the default values, and
	are themselves overridden by keywords entered on the command line.


 ENVIRONMENT VARIABLES:
	Grim defines no environment variables of its own, but as it is an
	interface to OMINAS, all OMINAS variables are relevant.


 COMMON BLOCKS:
	grim_block:	Keeps track of most recent grim instance and which 
			ones are selected.


 SIDE EFFECTS:
	Grim operates directly on the memory images of the descriptors that 
	it is given.  Therefore, those descriptors are modified during 
	a session.  This architecture allows data to be operated on concurrently
	through grim and from the command line; see ingrid.pro for details.


 LAYOUT:
	The grim layout consists of the following items:

	 Menu bar: Most of grim's functionality is accessed through the 
	           system of pulldown menus at the top.  Individual menu
	           items are described in their own sections below.

	 Shortcut buttons: Some common-used menu options are duplicated as
			   shortcut buttons, which are arranged horizontally 
			   just beneath the menu bar.  The following shortcuts 
			   are available, from left to right: 

		Previous plane: Changes to the previous plane.

		Next plane: Changes to the next plane.

		Refresh: Redisplays the image and overlays.

		Entire Image: Resets display parameters so that the enitre
		              image is visible.

		Previous view: Reverts to the previous view settings.

		Hide/Unhide: Toggles overlays on/off.

		Colors: Opens the color tool.

		Tracking: Toggles cursor tracking on/off.

		Grid: Toggles RA/DEC grid on/off.

		Axes: Toggles axes on/off.

		Activate all: Activates all overlays.

		Deactivate all: Deactivates all overlays.

		Header: Opens a window showing the image header.


	 Modes buttons: Modes buttons are arranged vertically along the 
	                left side.  The following modes are available, in order
	                of their appearance in the grim widget:

		Select: The top button toggles a given grim instance between
		        selected and unselected states, for use with functions
		        that require input from more than one grim instance. 
		        When a given instance is selected, this button
		        displays an asterisk.

		Context: This button toggles the visibility of a small context
			 window superimposed over the top-left corner of the
			 main image.  The context window always displays the
			 entire image and all of these modes except activation
			 function in the same way in the context window as in
			 the main window.

		Activate: In activate mode, overlay objects may be activated
			  or deactivated by clicking and/or dragging using the
			  left or right mouse buttons respectively.  This
			  activation mechanism allows the user to select which
			  among a certain type of objects should be used in a
			  given menu selection.  A left click on an overlay
			  activates that overlay and a right click deactivates
			  it.  A double click activates or deactivates all
			  overlays associated with a given descriptor, or all
			  stars.  Active overlays appear in the colors selected
			  in the 'Overlay Settings' menu selection.  Inactive
			  overlays appear in cyan.  A descriptor is active
			  whenever any of its overlays are active.

		Zoom: The zoom button puts grim in a zoom cursor mode, wherein
		      the image zoom and offset are controlled by selecting
		      a box in the image.  When the box is created using the
		      left mouse button, zoom and offset are changed so that 
		      the contents of the box best fill the current graphics
		      window.  When the right button is used, the contents of
		      the current graphics window are shrunken so as to best
		      fill the box.  In other words, the left button zooms in
		      and the right button zooms out.

		Pan: The pan button puts grim in a pan cursor mode, wherein the 
		     image offset is controlled by selecting an offset vector
		     using the left mouse button.  The middle button may be
		     used to center the image on a selected point.

		Pixel Readout:	In pixel readout mode, a text window appears 
				and displays data about the pixel selected 
				using the left mouse button.  

		Tiepoint: In tiepoint mode, tiepoints are added using the
		          left mouse button and deleted using the right button.
		          Tiepoints appear as crosses identified by numbers.
			  The use of tiepoints is determined by the particular 
			  option selected by the user.

		Magnify: In magnify mode, image pixels in the graphics
		         window may be magnifed using either the right or left
		         mouse buttons.  The left button magnifies the displayed
		         pixels, directly from the graphics window.  The right
		         button magnifies the data itself, without the overlays.

		XY Zoom: Same as 'zoom' above, except the aspect ratio is
                        set by the proportions of the selected box.

	 Graphics window: The graphics window displays the image associated 
	                  with the given data descriptor using the current 
	                  zoom, offset, and display order.  The edges of the
	                  image are indicated by a dotted line.

	 Pixel readout: The cursor position and corresponding data value are
	                are displayed beneath the graphics window, next to the
	                message line.

	 Message line: The message line displays short messages pertaining
	               grim's current state.

 RESOURCE NAMES
	The following X-windows resource names apply to grim:
	 grim_base:		top level base
	 grim_mbar:		menu bar
	 grim_shortcuts_base:	base containing shortcut buttons
	 grim_modes_base:	base containing modes buttons
	 grim_draw:		grim draw widget
	 grim_label:		grim bottom label widget

	To turn off the confusing higlight box around the modes buttons, 
	put the following line in your ~/.Xdefaults file:

	 Idl*grim_modes_base*highlightThickness:	0


 OPERATION:
	Grim maintains any number of image planes as well as associated
	geometric data (camera, planet, ring, star descriptors) for each of
	those planes.  Image planes are completely independent unless the 
	user chooses to display them simultaneously in separate red, green,
	and blue display channels.

	Each image plane also contains numerous overlay arrays for displaying
	various geometric objects -- limbs, rings, stars, etc.  An array of 
	user overlay points is maintained to be used for application-specific
	purposes.  Generally, a set of overlay points or a descriptor must be
	activated in order to be used as input to a menu item; see activate 
	mode above.  

	There are exclusive and non-exclusive mechanisms for selecting grim
	windows.  Grim windows may be non-exclusively selected using the select
	mode button mentioned above (upper-left corner).  The exclusive
	selection mechanism consists of a 'primary' grim window, indicated by 
	a red outline in the graphics window.  The primary selection is 
	changed by pressing any mode or shortcut button, or by clicking in 
	the graphics area of the desired grim window.


 EXAMPLES:
	(1) To create a new grim instance with no data:

		IDL> grim, /new

	(2) To create a new grim instance with data from a file of name
	    "filename":

		IDL> dd = nv_read(filename)
		IDL> grim, dd

	(3) To give a grim instance a new camera descriptor:

		IDL> grim, cd=cd


 STATUS:
	Incomplete.


 SEE ALSO:
	ingrid, gr_draw


 MODIFICATION HISTORY:
 	Written by:	Spitale 7/2002
	
