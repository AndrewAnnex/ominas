GAUSS2D_FIT

 PURPOSE:
 	Fit a 2 dimensional elliptical gaussian equation to rectilinearly
	gridded data.
		Z = F(x,y) where:
 		F(x,y) = A0 + A1*EXP(-U/2)
	   And the elliptical function is:
		U= (x'/a)^2 + (y'/b)^2
	The parameters of the ellipse U are:
	   Axis lengths are 2*a and 2*b, in the unrotated X and Y axes,
		respectively.
	   Center is at (h,k).
	   Rotation of T radians from the X axis, in the CLOCKWISE direction.
	   The rotated coordinate system is defined as:
		x' = (x-h) * cos(T) - (y-k) * sin(T)  <rotate by T about (h,k)>
		y' = (x-h) * sin(T) + (y-k) * cos(T)

	The rotation is optional, and may be forced to 0, making the major/
	minor axes of the ellipse parallel to the X and Y axes.

	The coefficients of the function, are returned in a seven
	element vector:
	a(0) = A0 = constant term.
	a(1) = A1 = scale factor.
	a(2) = a = width of gaussian in X direction.
	a(3) = b = width of gaussian in Y direction.
	a(4) = h = center X location.
	a(5) = k = center Y location.
	a(6) = T = Theta the rotation of the ellipse from the X axis
		in radians, counterclockwise.


 CATEGORY:
	curve / data fitting

 CALLING SEQUENCE:
	Result = GAUSS2DFIT(z, a [,x,y])

 INPUTS:
	Z = dependent variable in a 2D array dimensioned (Nx, Ny).  Gridding
		must be rectilinear.
	X = optional Nx element vector containing X values of Z.  X(i) = X value
		for Z(i,j).  If omitted, a regular grid in X is assumed,
		and the X location of Z(i,j) = i.
	Y = optional Ny element vector containing Y values of Z.  Y(j) = Y value
		for Z(i,j).  If omitted, a regular grid in Y is assumed,
		and the Y location of Z(i,j) = j.

 Optional Keyword Parameters:
	NEGATIVE = if set, implies that the gaussian to be fitted
		is a valley (such as an absorption line).
		By default, a peak is fit.
	TILT = if set to  1, allow the orientation of the major/minor axes of 
		the ellipse to be unrestricted.  The default is that
		the axes of the ellipse must be parallel to the X-Y axes.
		In this case, A(6) is always returned as 0.

 OUTPUTS:
	The fitted function is returned.
 OUTPUT PARAMETERS:
	A:	The coefficients of the fit.  A is a seven element vector as
		described under PURPOSE.
	chisq:	chisq value for the fit.

 COMMON BLOCKS:
	None.
 SIDE EFFECTS:
	None.
 RESTRICTIONS:
	Timing:  Approximately 4 seconds for a 128 x 128 array, on a 
		Sun SPARC LX.  Time required is roughly proportional to the 
		number of elements in Z.

 PROCEDURE:
	The peak/valley is found by first smoothing Z and then finding the
	maximum or minimum respectively.  Then GAUSSFIT is applied to the row
	and column running through the peak/valley to estimate the parameters
	of the Gaussian in X and Y.  Finally, CURVEFIT is used to fit the 2D
	Gaussian to the data.

	Be sure that the 2D array to be fit contains the entire Peak/Valley
	out to at least 5 to 8 half-widths, or the curve-fitter may not
	converge.

 EXAMPLE:  This example creates a 2D gaussian, adds random noise
	and then applies GAUSS2DFIT:
	nx = 128		;Size of array
	ny = 100
	;**  Offs Scale X width Y width X cen Y cen  **
	;**   A0  A1    a       b       h       k    **
	a = [ 5., 10., nx/6.,  ny/10., nx/2., .6*ny]  ;Input function parameters
	x = findgen(nx) # replicate(1.0, ny)	;Create X and Y arrays
	y = replicate(1.0, nx) # findgen(ny)
	u = ((x-a(4))/a(2))^2 + ((y-a(5))/a(3))^2  ;Create ellipse
	z = a(0) + a(1) * exp(-u/2)		;to gaussian
	z = z + randomn(seed, nx, ny)		;Add random noise, SD = 1
	yfit = gauss2dfit(z,b)			;Fit the function, no rotation
	print,'Should be:',string(a,format='(6f10.4)')  ;Report results..
	print,'Is:      :',string(b(0:5),format='(6f10.4)')

 MODIFICATION HISTORY:
	DMS, RSI, June, 1995.
	Spitale, 3/2004; added chisq output.
